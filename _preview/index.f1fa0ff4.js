var X=Object.defineProperty;var ee=(e,t,r)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var A=(e,t,r)=>(ee(e,typeof t!="symbol"?t+"":t,r),r);import{r as ref,c as computed,W as useRouter,P as useRuntimeConfig}from"./entry.819ce933.js";import{P as commonjsGlobal,Q as getDefaultExportFromCjs,j as dayjs,R as standardFieldsStore,S as countries,m as mapCustomValues,y as parseAndFetchUserData,u as usePreviewStore,T as PaymentServices,U as attributionEventData,V as getSessionId,W as getSessionFingerprint,X as defaultPadding,Y as defaultShadow,Z as HISTORY_KEY,_ as USER_SESSION_KEY,$ as USER_SESSION_HISTORY_KEY,a0 as USER_FINGERPRINT_KEY,a1 as FIRST_EVENT_KEY}from"./constants.8e39bf94.js";var customParseFormat$1={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(commonjsGlobal,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},s=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|YYYY|YY?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,a=/\d\d/,i=/\d\d?/,l=/\d*[^-_:/,()\s\d]+/,g={},p=function(c){return(c=+c)+(c>68?1900:2e3)},n=function(c){return function(o){this[c]=+o}},v=[/[+-]\d\d:?(\d\d)?|Z/,function(c){(this.zone||(this.zone={})).offset=function(o){if(!o||o==="Z")return 0;var f=o.match(/([+-]|\d\d)/g),m=60*f[1]+(+f[2]||0);return m===0?0:f[0]==="+"?-m:m}(c)}],u=function(c){var o=g[c];return o&&(o.indexOf?o:o.s.concat(o.f))},h=function(c,o){var f,m=g.meridiem;if(m){for(var S=1;S<=24;S+=1)if(c.indexOf(m(S,0,o))>-1){f=S>12;break}}else f=c===(o?"pm":"PM");return f},w={A:[l,function(c){this.afternoon=h(c,!1)}],a:[l,function(c){this.afternoon=h(c,!0)}],S:[/\d/,function(c){this.milliseconds=100*+c}],SS:[a,function(c){this.milliseconds=10*+c}],SSS:[/\d{3}/,function(c){this.milliseconds=+c}],s:[i,n("seconds")],ss:[i,n("seconds")],m:[i,n("minutes")],mm:[i,n("minutes")],H:[i,n("hours")],h:[i,n("hours")],HH:[i,n("hours")],hh:[i,n("hours")],D:[i,n("day")],DD:[a,n("day")],Do:[l,function(c){var o=g.ordinal,f=c.match(/\d+/);if(this.day=f[0],o)for(var m=1;m<=31;m+=1)o(m).replace(/\[|\]/g,"")===c&&(this.day=m)}],M:[i,n("month")],MM:[a,n("month")],MMM:[l,function(c){var o=u("months"),f=(u("monthsShort")||o.map(function(m){return m.slice(0,3)})).indexOf(c)+1;if(f<1)throw new Error;this.month=f%12||f}],MMMM:[l,function(c){var o=u("months").indexOf(c)+1;if(o<1)throw new Error;this.month=o%12||o}],Y:[/[+-]?\d+/,n("year")],YY:[a,function(c){this.year=p(c)}],YYYY:[/\d{4}/,n("year")],Z:v,ZZ:v};function K(c){var o,f;o=c,f=g&&g.formats;for(var m=(c=o.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(d,y,F){var I=F&&F.toUpperCase();return y||f[F]||r[F]||f[I].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(x,L,M){return L||M.slice(1)})})).match(s),S=m.length,b=0;b<S;b+=1){var _=m[b],P=w[_],C=P&&P[0],Y=P&&P[1];m[b]=Y?{regex:C,parser:Y}:_.replace(/^\[|\]$/g,"")}return function(d){for(var y={},F=0,I=0;F<S;F+=1){var x=m[F];if(typeof x=="string")I+=x.length;else{var L=x.regex,M=x.parser,R=d.slice(I),T=L.exec(R)[0];M.call(y,T),d=d.replace(T,"")}}return function(E){var D=E.afternoon;if(D!==void 0){var U=E.hours;D?U<12&&(E.hours+=12):U===12&&(E.hours=0),delete E.afternoon}}(y),y}}return function(c,o,f){f.p.customParseFormat=!0,c&&c.parseTwoDigitYear&&(p=c.parseTwoDigitYear);var m=o.prototype,S=m.parse;m.parse=function(b){var _=b.date,P=b.utc,C=b.args;this.$u=P;var Y=C[1];if(typeof Y=="string"){var d=C[2]===!0,y=C[3]===!0,F=d||y,I=C[2];y&&(I=C[2]),g=this.$locale(),!d&&I&&(g=f.Ls[I]),this.$d=function(R,T,E){try{if(["x","X"].indexOf(T)>-1)return new Date((T==="X"?1e3:1)*R);var D=K(T)(R),U=D.year,O=D.month,J=D.day,z=D.hours,Z=D.minutes,W=D.seconds,G=D.milliseconds,q=D.zone,$=new Date,V=J||(U||O?1:$.getDate()),k=U||$.getFullYear(),N=0;U&&!O||(N=O>0?O-1:$.getMonth());var Q=z||0,j=Z||0,H=W||0,B=G||0;return q?new Date(Date.UTC(k,N,V,Q,j,H,B+60*q.offset*1e3)):E?new Date(Date.UTC(k,N,V,Q,j,H,B)):new Date(k,N,V,Q,j,H,B)}catch{return new Date("")}}(_,Y,P),this.init(),I&&I!==!0&&(this.$L=this.locale(I).$L),F&&_!=this.format(Y)&&(this.$d=new Date("")),g={}}else if(Y instanceof Array)for(var x=Y.length,L=1;L<=x;L+=1){C[1]=Y[L-1];var M=f.apply(this,C);if(M.isValid()){this.$d=M.$d,this.$L=M.$L,this.init();break}L===x&&(this.$d=new Date(""))}else S.call(this,b)}}})})(customParseFormat$1);var customParseFormatExports=customParseFormat$1.exports;const customParseFormat=getDefaultExportFromCjs(customParseFormatExports);dayjs.extend(customParseFormat);const fillDataForStandardFieldUri=async(e,t,r,s,a,i,l=!1)=>{const g=ref(r),p=ref(s),n=ref(a),v=ref(i);let u=e||t.query;l&&(u={});const h=standardFieldsStore.map(o=>{var m;if(o in u)if(o==="phone"&&u[o]){let S=u[o];u[o][0]===" "&&(S=S.split(""),S[0]="+",S=S.join("")),g.value.phone=S}else o==="country"&&u[o]&&countries.hasOwnProperty(u[o])?p.value=countries[u[o]]:n.value[o]=(m=u[o])==null?void 0:m.replace(/\+/g," ")});await Promise.all(h);let w=[];const K=await Promise.all(v.value.map(o=>{o.hiddenFieldQueryKey&&w.push(o)}));await Promise.all(K);const c=w.map(o=>{var m,S,b,_,P,C,Y;if(o.hiddenFieldQueryKey in u)if(o.type==="phone"&&u[o.hiddenFieldQueryKey]){let d=u[o.hiddenFieldQueryKey];u[o.hiddenFieldQueryKey][0]===" "&&(d=d.split(""),d[0]="+",d=d.join("")),g.value[o.tag]=d}else if(o.type==="checkbox")if(u[o.hiddenFieldQueryKey].includes(",")){let d=u[o.hiddenFieldQueryKey].split(",");n.value[o.tag]=d.map(y=>y==null?void 0:y.trim())}else n.value[o.tag]=[u[o.hiddenFieldQueryKey]];else if(o.type==="email")n.value[o.tag]=(m=u[o.hiddenFieldQueryKey])==null?void 0:m.replace(/ /g,"+");else if(o.type==="date"){const d=((S=o.format)==null?void 0:S.replace(/-/g,o.separator||"-"))||"YYYY-MM-DD",y=(b=u[o.hiddenFieldQueryKey])==null?void 0:b.replace(/ /g,""),F=dayjs(y,[d,"MMMDoYYYY","MMM Do YYYY"]).isValid()?dayjs(y,[d,"MMMDoYYYY"]).format(d):"";n.value[o.tag]=dayjs(F,d,!0).isValid()?F:""}else o.type==="monetory"?n.value[o.tag]=(_=u[o.hiddenFieldQueryKey])==null?void 0:_.replace(/[^\d.,]/g,""):n.value[o.tag]=(P=u[o.hiddenFieldQueryKey])==null?void 0:P.replace(/\+/g," ");else{if(o.type==="phone"&&o.hiddenFieldValue){let d=o.hiddenFieldValue;o.hiddenFieldValue[0]===" "&&(d=d.split(""),d[0]="+",d=d.join("")),g.value[o.tag]=d}if(o.type==="date"&&o.hiddenFieldValue){const d=((C=o.format)==null?void 0:C.replace(/-/g,o.separator||"-"))||"YYYY-MM-DD",y=mapCustomValues(o.hiddenFieldValue||n.value[o.tag]),F=dayjs(y,[d,"MMMDoYYYY","MMM Do YYYY"]).isValid()?dayjs(y,[d,"MMMDoYYYY"]).format(d):"";n.value[o.tag]=dayjs(F,d,!0).isValid()?F:""}else o.hiddenFieldValue&&(n.value[o.tag]=(Y=mapCustomValues(o.hiddenFieldValue))==null?void 0:Y.replace(/\+/g," "))}});return await Promise.all(c),console.log("formFieldsValue after fillDataForStandardFieldUri",n.value),{phoneCountryIncluded:g.value,formattedCountry:p.value,formFieldsValue:n.value,formFields:v.value}},fillDataFromCookie=async(e,t,r,s,a,i)=>{const l=ref(s),g=ref(a),p=ref(i),n=e||parseAndFetchUserData(t);if(!n)return;const v=standardFieldsStore.map(u=>{if(r.includes(u))if(u==="phone"){let h=n[u];h&&h[0]===" "&&(h=h.split(""),h[0]="+",h=h.join("")),g.value.phone=h}else u==="country"&&n[u]?p.value=countries[n[u]]:u==="address"&&!n[u]&&n.address1?l.value[u]=n.address1:l.value[u]=n[u]});return await Promise.all(v),{formFieldsValue:l.value,formattedCountry:p.value,phoneCountryIncluded:g.value}},getCountryFieldValue=(e,t)=>{const r=ref(e),s=ref(t);return s.value&&(r.value.country=Object.keys(countries).find(a=>countries[a]===s.value)),{formFieldsValue:r.value}},getHiddenFieldValue=async(e,t,r)=>{const s=e.query,a=ref(r),i=t.map(l=>{l.hidden&&l.type!="source"&&(!l.hiddenFieldQueryKey||!(l.hiddenFieldQueryKey in s))&&(a.value[l.tag]=a.value[l.tag]||l.hiddenFieldValue)});return await Promise.all(i),{formFieldsValue:a.value}},getTotalFilesSize=e=>{let t=0;return Object.keys(e).forEach(r=>{if(e[r]instanceof File)t+=e[r].size;else if(e[r]&&e[r].hasOwnProperty("files")){let s=e[r].files.length;for(let a=0;a<s;a++)t+=e[r].files[a].size}}),t},usePreviewStyle=()=>{const e=ref({}),t=()=>{var i,l,g,p,n,v,u,h,w,K,c,o,f,m,S,b,_,P,C,Y,d,y,F,I;return{backgroundColor:"#"+((i=e.value)==null?void 0:i.bgColor),color:"#"+((l=e.value)==null?void 0:l.color),border:((g=e.value)==null?void 0:g.border)+"px "+((p=e.value)==null?void 0:p.borderStyle)+" #"+e.value.borderColor,borderRadius:e.value.radius+"px",maxWidth:e.value.width+"px",width:"100%",marginTop:e.value.marginTop?(n=e.value)==null?void 0:n.marginTop:"",borderColor:"#"+((v=e.value)==null?void 0:v.borderColor),paddingTop:parseFloat((h=(u=e.value)==null?void 0:u.padding)==null?void 0:h.top)+"px",paddingBottom:parseFloat((K=(w=e.value)==null?void 0:w.padding)==null?void 0:K.bottom)+"px",paddingLeft:parseFloat((o=(c=e.value)==null?void 0:c.padding)==null?void 0:o.left)+"px",paddingRight:parseFloat((m=(f=e.value)==null?void 0:f.padding)==null?void 0:m.right)+"px",boxShadow:((b=(S=e.value)==null?void 0:S.shadow)==null?void 0:b.horizontal)+"px "+((P=(_=e.value)==null?void 0:_.shadow)==null?void 0:P.vertical)+"px "+((Y=(C=e.value)==null?void 0:C.shadow)==null?void 0:Y.blur)+"px "+((y=(d=e.value)==null?void 0:d.shadow)==null?void 0:y.spread)+"px #"+((I=(F=e.value)==null?void 0:F.shadow)==null?void 0:I.color)}},r=()=>{var i,l,g,p,n,v,u,h,w,K,c,o,f,m,S,b,_,P,C,Y,d,y,F,I,x,L,M,R;return{backgroundColor:"#"+((i=e.value)==null?void 0:i.bgColor),color:"#"+((l=e.value)==null?void 0:l.color),border:((g=e.value)==null?void 0:g.border)+"px "+((p=e.value)==null?void 0:p.borderStyle)+" #"+((n=e.value)==null?void 0:n.borderColor),borderRadius:((v=e.value)==null?void 0:v.radius)+"px",maxWidth:((u=e.value)==null?void 0:u.width)+"px",width:"100%",marginTop:(h=e.value)!=null&&h.marginTop?(w=e.value)==null?void 0:w.marginTop:"",borderColor:"#"+((K=e.value)==null?void 0:K.borderColor),paddingTop:parseFloat((o=(c=e.value)==null?void 0:c.padding)==null?void 0:o.top)+"px",paddingBottom:parseFloat((m=(f=e.value)==null?void 0:f.padding)==null?void 0:m.bottom)+"px",paddingLeft:((b=(S=e.value)==null?void 0:S.padding)==null?void 0:b.left)+"px",paddingRight:((P=(_=e.value)==null?void 0:_.padding)==null?void 0:P.right)+"px",boxShadow:((Y=(C=e.value)==null?void 0:C.shadow)==null?void 0:Y.horizontal)+"px "+((y=(d=e.value)==null?void 0:d.shadow)==null?void 0:y.vertical)+"px "+((I=(F=e.value)==null?void 0:F.shadow)==null?void 0:I.blur)+"px "+((L=(x=e.value)==null?void 0:x.shadow)==null?void 0:L.spread)+"px #"+((R=(M=e.value)==null?void 0:M.shadow)==null?void 0:R.color)}},s=(i,l)=>{var g,p,n,v;e.value={bgColor:i==null?void 0:i.background,border:(g=i==null?void 0:i.border)==null?void 0:g.border,borderStyle:(p=i==null?void 0:i.border)==null?void 0:p.style,borderColor:(n=i==null?void 0:i.border)==null?void 0:n.color,radius:(v=i==null?void 0:i.border)==null?void 0:v.radius,width:l,padding:(i==null?void 0:i.padding)||defaultPadding,shadow:(i==null?void 0:i.shadow)||defaultShadow,marginTop:i==null?void 0:i.marginTop}};return{getFormWidth:computed(()=>{var i;return((i=e==null?void 0:e.value)==null?void 0:i.width)||"auto"}),getFormStyle:t,setFormStyle:s,getSurveyStyle:r}},verifyRedirectedPayment=async(e,t,r,s)=>{try{const a=usePreviewStore();useRouter().replace({query:void 0});const l=a.value.locationId;let g;if(r){const p={altId:l,altType:"location",transactionId:r};g=await PaymentServices.verifyGenernalPayment(p)}else{let p;const n=sessionStorage.getItem(`formOrderResponse-${t}`);n&&(p=JSON.parse(n));const v={altId:l,altType:"location",orderId:p.order._id,paymentIntentId:e,setupIntentId:s,isAuth:!!s,attribution:{eventData:attributionEventData(),sessionId:getSessionId(l),sessionFingerprint:getSessionFingerprint(l)}};g=await PaymentServices.verifyStripePayment(v)}if(g.success)return g;throw new Error(g.message)}catch{return window.alert("An error occured while trying to process your payment. Please try again."),!1}finally{sessionStorage.removeItem("formOrderResponse"),sessionStorage.removeItem("formContactResponse"),sessionStorage.removeItem("submissionResponse")}},findIdByQueryKey=(e,t)=>{for(const r of e)if(r.hiddenFieldQueryKey===t&&(r.Id||r.id))return r.Id||r.id;return null},calculateScore=(form,formFields,tdata)=>{const data={...tdata},scoreFields=form==null?void 0:form.fields.filter(e=>e.dataType==="SCORE"),operatorsAndNumbers=["â†","(",")","*","7","8","9","-","4","5","6","+","1","2","3","/","0","."],results=scoreFields.map(scoreField=>{const calculation=scoreField==null?void 0:scoreField.calculation;if(!(calculation!=null&&calculation.length))return null;const expression=calculation.map((e,t)=>{const r=findIdByQueryKey(formFields,e);return r!==null&&(e=r),data[e]?typeof data[e]=="string"?isNaN(parseFloat(data[e]))?0:parseFloat(data[e]):data[e]:operatorsAndNumbers.includes(e)?e:0}).join("").split(" ").reduce((e,t,r,s)=>r<s.length-1&&s[r+1]!=="."&&!isNaN(Number(s[r+1]))?e+t:e+t+" ","").trim();try{const result=parseFloat(eval(expression).toFixed(2));return{hiddenFieldQueryKey:scoreField.tag,result}}catch(e){return console.log("Error evaluating expression:",expression,e),{hiddenFieldQueryKey:scoreField.tag,result:0}}});return results.filter(e=>e!==null)};function internalLog(...e){getUriParams("internalLog")&&getUriParams("internalLog")=="ghl_team"&&console.log(e)}function isInIframe(){try{return window.self!==window.top}catch{return!0}}function guessUrl(e,t){let r=e;if(e||(r=document.location.href),r&&t){let s=new URL(r);internalLog("function guessUrl: ",r,t),Object.keys(t).forEach(a=>{s.searchParams.has(a)||s.searchParams.append(a,t[a])}),internalLog("function guessUrl newer url: ",s.href),r=s.href}return!e&&isInIframe()&&(r=document.referrer||r),r}function uriParams(e){const t={};if(!e)return t;try{return new URL(e).searchParams.forEach((s,a)=>{t[a]=s}),t}catch{return console.log("full url missing: ",e),t}}function getUriParams(e,t){const r=uriParams(t||guessUrl());return e in r?r[e]:""}function getCampaign(e){return getUriParams("utm_campaign",e)||getUriParams("campaign",e)}function getKeyword(e){return getUriParams("keyword",e)||getUriParams("utm_term",e)||getUriParams("utm_content",e)}function getAdSource(e){if(getUriParams("gclid",e))return"adword";if(getUriParams("msclkid",e))return"bing";if(getUriParams("dclid",e))return"yahoo";const t=getUriParams("utm_source",e),r=getCampaign(e);return t&&t.toLowerCase()=="facebook"&&r?"facebook":t&&t.toLowerCase()=="fb_ad"&&r?"fb_ad":t&&t.toLowerCase()=="linkedin_ad"&&r?"linkedin_ad":t&&t.toLowerCase()=="twitter_ad"&&r?"twitter_ad":""}function getBaseUrl(){return`${useRuntimeConfig().public.REST_API_URLS}/attribution_service`}function referrer(e,t){const r=getUriParams("rf");if(r&&typeof r=="string"&&r=="false")return"";let s;try{t&&typeof t=="string"&&(s=new URL(t).host)}catch{}if(e&&!e.includes(s))return e;const a=getUriParams("hl_referrer");return a||(!isInIframe()&&document.referrer&&!document.referrer.includes(document.location.origin)?document.referrer:"")}function getReferrerSource(e,t){if(e==="")return"direct";if(e.includes("google"))return t.includes("gclid")?"google paid":"google organic";if(e.includes("twitter"))return"twitter";if(e.includes("bing"))return t.includes("msclkid")?"bing paid":"bing organic";if(e.includes("facebook"))return"facebook";if(e.includes("yahoo"))return t.includes("dclid")||t.includes("yahoo")?"yahoo paid":"yahoo organic";if(e.includes("duckduckgo"))return"duckduckgo";{const r=document.createElement("a");return r.setAttribute("href",e),r.hostname}}function isLocalStorageAccessible(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),!0}catch{return!1}}function getStorageItem(e){if(isLocalStorageAccessible("localStorage"))return localStorage.getItem(e)}function setStorageItem(e,t){isLocalStorageAccessible("localStorage")&&localStorage.setItem(e,t)}function removeStorageItem(e){isLocalStorageAccessible("localStorage")&&localStorage.removeItem(e)}function getCookieFromLocalStore(e){if(!isLocalStorageAccessible("localStorage"))return;const t=localStorage.getItem(e);if(!t)return null;const r=JSON.parse(t);return new Date().getTime()>r.expiry?(localStorage.removeItem(e),null):r.value}function getAttributionCookie(e){const t=getCookieFromLocalStore(e);if(t)return t;const r=e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),s=document.cookie.match(new RegExp("(^| )"+r+"=([^;]+)"));return s&&s[2]?s[2]:""}function setCookiesOnLocalStorage(e,t,r){if(!isLocalStorageAccessible("localStorage"))return;const a={value:t,expiry:new Date().getTime()+r};localStorage.setItem(e,JSON.stringify(a))}function setCookie(e,t,r){if(isLocalStorageAccessible("localStorage")){var s=31536e6;r&&(s=r*24*60*60*1e3),setCookiesOnLocalStorage(e,t,s)}else{let a="";if(r){let i=new Date;i.setTime(i.getTime()+r*24*60*60*1e3),a="; expires="+i.toUTCString()}document.cookie=e+"="+(t||"")+a+"; path=/"}}function setCookieMinute(e,t,r){if(isLocalStorageAccessible("localStorage"))r||(r=1),setCookiesOnLocalStorage(e,t,r*60*1e3);else{let s="";if(r){const a=new Date;a.setTime(a.getTime()+r*60*1e3),s="; expires="+a.toUTCString()}document.cookie=e+"="+(t||"")+s+"; path=/"}}function historyKey(e){return e=e||getAttributionCookie("location_id"),e?`${HISTORY_KEY}_${e}`:HISTORY_KEY}function userSessionKey(e){return e=e||getAttributionCookie("location_id"),e?`${USER_SESSION_KEY}${e}_session_id`:`${USER_SESSION_KEY}id`}function contactSessionHistoriesKey(e){return e=e||getAttributionCookie("location_id"),`${USER_SESSION_HISTORY_KEY}${e}`}function userFingerprintKey(e){return e=e||getAttributionCookie("location_id"),`${USER_FINGERPRINT_KEY}${e}_fingerprint`}function firstSessionKey(e){return`${FIRST_EVENT_KEY}${e}`}function isBot(){return/bot|google|baidu|bing|msn|duckduckbot|teoma|slurp|yandex/i.test(navigator.userAgent)}async function request(e,t){try{var r=await fetch(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});return await r.json()}catch{return{}}}function getFBP(){return getAttributionCookie("_fbp")}function getFBC(){return getAttributionCookie("_fbc")}function parseJSON(e){if(!e)return null;try{return JSON.parse(e)}catch(t){return console.log(t),null}}class UserSessionAttribution{constructor(t,r){A(this,"baseUrl");A(this,"locationId");A(this,"fingerprint");A(this,"type");A(this,"parentId");A(this,"parentName");this.baseUrl=getBaseUrl(),this.locationId=t,this.fingerprint=r}eventData(t,r){let s,a;if(this.locationId){let l=getStorageItem(contactSessionHistoriesKey(this.locationId));l&&(s=l),a=getAttributionCookie(firstSessionKey(this.locationId))}internalLog("function eventData: ",this.locationId,a);let i=guessUrl(t,a==null?void 0:a.url_params);return{source:getReferrerSource(referrer(r,t),document.location.href),referrer:referrer(r,t)||(a==null?void 0:a.referrer)||"",keyword:getKeyword(i),adSource:getAdSource(i),url_params:uriParams(i),page:{url:i,title:document.title},timestamp:Date.now(),campaign:getCampaign(i),contactSessionIds:parseJSON(s),fbp:getFBP(),fbc:getFBC()}}pageVisitData(t,r,s){return internalLog("function pageVisitData: ",t,r,s),{...this.eventData(t,r),type:"page-visit",parentId:getUriParams("trigger_link")?getUriParams("trigger_link"):this.parentId||"",pageVisitType:getUriParams("trigger_link")?"trigger-link":this.type||"",domain:document.domain,version:"v3",parentName:this.parentName||"",fingerprint:null,documentURL:document==null?void 0:document.URL,...s}}async store(t,r,s,a,i,l,g){internalLog("extras form script: ",g),this.locationId=t;var p=this.fingerprint||getAttributionCookie("fingerprint"),n=getAttributionCookie(userSessionKey(t));if(this.type=r,this.parentId=s,this.parentName=a,isBot())return;const v=referrer(l,i);if(n||setCookieMinute(userSessionKey(t),"temp",1),n=="temp")return;n||(internalLog(`Not found sessionId so removing older sessions: ${userSessionKey(t)}`),removeStorageItem(historyKey(t))),n&&setCookieMinute(userSessionKey(t),n,30);let u=parseJSON(getStorageItem(historyKey(t)));if(internalLog("function store: history",u),u&&u.sessions){const o=u.sessions[u.sessions.length-1],f=getAttributionCookie(firstSessionKey(t));let m=guessUrl(i,f==null?void 0:f.url_params);(o.referrer!=(referrer(l,i)||(f==null?void 0:f.referrer)||"")||o.campaign!=getCampaign(m))&&(internalLog(`Referrer and campaign change > newReferrer: ${referrer(l,i)} > old referrer: ${o.referrer}`),u=null,n=null,removeStorageItem(historyKey(t)))}if(u)if(n&&u&&r!="call-swap"){internalLog("function store: sessionId & history",n,u);var K=u.sessions,c=this.pageVisitData(i,l,g);internalLog("function store: newSession",c);try{var w=await request(`${this.baseUrl}/user_session_v3/update_session/${n}`,{locationId:t,sessions:c});c.fingerprint=w.fingerprint,setStorageItem(historyKey(t),JSON.stringify({sessions:[...K,c]}))}catch(o){console.log(o)}}else removeStorageItem(historyKey(t)),await this.store(t,r,s,a,i,l);else{var h=this.pageVisitData(i,l,g);internalLog("function store: sessions",h);try{var w=await request(`${this.baseUrl}/user_session_v3/create_session`,{sessions:h,initialReferrer:v,locationId:t,fingerprint:p,sessionId:n});(!n||n!=w.sessionId)&&setCookieMinute(userSessionKey(t),w.sessionId,30),h.fingerprint=w.fingerprint,setStorageItem(historyKey(t),JSON.stringify({sessions:[h]}));let o=parseJSON(getStorageItem(contactSessionHistoriesKey(t)));o?o.ids.push(w.sessionId):(o={ids:[w.sessionId]},setCookieMinute(firstSessionKey(t),h,30)),internalLog("function store: contactSessionIds",o),setStorageItem(contactSessionHistoriesKey(t),JSON.stringify(o))}catch(o){console.log(o),removeStorageItem(historyKey(t))}}}async create(t,r,s,a,i,l,g){this.locationId=t;var p=getAttributionCookie(userSessionKey(t)),n=getUriParams("sessionId");let v=10;(!p||p=="temp")&&(v=100),setTimeout(async()=>{n&&setCookie(userSessionKey(t),n,365),await this.store(t,r,s,a,i,l,g)},v)}update(t){const r=t.sessionId||"",s=t.locationId||"";this.locationId=s,r&&(setCookieMinute(userSessionKey(s),r,30),removeStorageItem(contactSessionHistoriesKey(s)))}getCookie(t){return getAttributionCookie(t)}setCookies(t,r){t&&r&&setCookie(t,r)}getSessionId(t){return getAttributionCookie(userSessionKey(t||this.locationId))}getUserFingerprint(t){return getAttributionCookie(userFingerprintKey(t||this.locationId))}setUserFingerprint(t,r){return setCookie(userFingerprintKey(t||this.locationId),r)}}const setupSession=async()=>{var e=typeof window>"u"?{}:window,t=e.userSessionAttribution;t||(t=e.userSessionAttribution=new UserSessionAttribution)};export{getFBC as a,fillDataFromCookie as b,customParseFormat as c,getTotalFilesSize as d,getCountryFieldValue as e,fillDataForStandardFieldUri as f,getFBP as g,getHiddenFieldValue as h,calculateScore as i,setupSession as s,usePreviewStyle as u,verifyRedirectedPayment as v};
