import{d as J,I as X,c as v,r as h,o as _,J as ee,B as te,w as P,f as n,a as l,b as d,e as r,n as c,i as u,Q as y,t as g,a7 as M,z as F,m as ie,v as oe,S as ne,R,ab as ae,h as le,p as re,P as de,u as ue}from"./entry.819ce933.js";import{v as D,i as se,a as me}from"./HtmlInput.vue.5c04a560.js";import{F as ce}from"./FunnelServices.4c5adf48.js";import{l as he,i as ye}from"./IntlTel.1c739c61.js";import{V as fe,o as ve}from"./optimize_script.d39a5f5b.js";import{S as ge}from"./ShortLabel.239ac2f5.js";import{C as be}from"./check-circle.5da2af7d.js";import{aq as q,as as $}from"./constants.8e39bf94.js";const Ce=["id"],ke=["innerHTML"],pe={key:1},Ve={key:0},Se={key:2},Pe=["value","name","placeholder","id","data-q","data-required"],Fe=["onClick"],we={key:0,class:"verified-text"},Ie=["src"],Te={key:1,class:"verification-container"},qe=r("br",null,null,-1),Le=["onClick"],Oe=["onClick"],Ee=["placeholder","name","id","data-q","data-required"],Ne=["type","placeholder","name","id","data-q","data-required"],xe={key:5,id:"error-container",class:"error"},Ue={key:6,id:"error-container",class:"error"},We=J({__name:"TextElement",props:{kind:{type:String},item:{type:Object},formLabelVisible:{type:Boolean},phoneCountryIncluded:{type:Object},phoneCountryCode:{type:Object},formattedPhone:{type:Object},locationCountry:{type:String},formFieldsValue:{type:Object},phoneFields:{type:Object},phoneCountryDerived:{type:String},layoutType:Object,checkFullWidthPosition:{type:Boolean},fontSize:{type:[Number,String]},locationId:{type:String},mediumId:{type:String},errors:{type:Object,default:()=>({})}},emits:["addOrUpdateError","isSlideMovable","customFieldPhoneNumberUpdate","updatePhoneCountryDerived","verifyPhone"],setup(t,{expose:j,emit:b}){const e=t,{t:B}=X(),L=de(),w=v(()=>{var i;return((i=e.item)==null?void 0:i.enableCountryPicker)!==!1}),O=h(),C=h(),K=i=>{e.phoneCountryIncluded[e.item.tag]=i.target.value},z=v(()=>e.kind=="form"),f=v(()=>e.kind=="survey"),E=v(()=>e.errors[e.item.tag]),W=()=>{var i;((i=e.item)==null?void 0:i.tag)==="phone"&&ve(()=>{ue(he(w,{intlTelFunc:()=>{w.value&&ye(x)}}))})};_(()=>{var i;((i=e.item)==null?void 0:i.tag)==="phone"&&ce.getGeoLocation().then(o=>{const a=o.country!=="ZZ"?o.country:e.locationCountry;e.phoneCountryCode[e.item.tag]=a,Q(a),e.phoneCountryIncluded[e.item.tag]&&e.phoneCountryCode[e.item.tag]&&T({tag:e.item.tag})}).catch(o=>{console.error("Error while fetching headers: ",o)})});const T=i=>{b("customFieldPhoneNumberUpdate",i)},N=i=>{f.value&&b("isSlideMovable",i)},x=()=>{var o;const i=O.value;i&&(C.value=(o=window==null?void 0:window.intlTelInput)==null?void 0:o.call(window,i,{preferredCountries:["us","gb","ca","au"],initialCountry:e.locationCountry.toLowerCase()||"us"}),i.addEventListener("countrychange",()=>{if(!C.value)return;const a=C.value.getNumber(),m=C.value.getSelectedCountryData().iso2;e.phoneCountryIncluded[i.name]=a,e.phoneCountryCode[i.name]=m?m.toUpperCase():"US",T({tag:i.name})}))},Q=i=>{b("updatePhoneCountryDerived",i)},H=i=>{var a,m;if(f.value)return;const o=e.formFieldsValue[e.item.tag];if(e.item.required&&se(o))s(e.item.tag,((a=e.item)==null?void 0:a.error)??` ${e.item.label} is required`);else if(e.item.tag==="phone")if(!D(o,e.phoneCountryCode[e.item.tag]?e.phoneCountryCode[e.item.tag]:e.locationCountry))s(e.item.tag,B("invalid_phone_no"));else if(e.item.enableValidatePhone&&!((m=e.item)!=null&&m.hidden)&&!I.value&&o){s(e.item.tag,"Phone is not verified!");return}else s(e.item.tag,null);else e.item.tag==="website"&&!me(o)?s(e.item.tag,"Invalid url"):s(e.item.tag,null)},k=h(""),p=h(null),U=h(null),V=h(!1),I=h(!1),Y=v(()=>e.formFieldsValue[e.item.tag]?e.item.enableValidatePhone&&D(e.formFieldsValue[e.item.tag],e.phoneCountryCode[e.item.tag]?e.phoneCountryCode[e.item.tag]:e.locationCountry):!1),G=()=>{var a;V.value=!0;const i=(a=window.libphonenumber.parsePhoneNumberFromString(e.formFieldsValue[e.item.tag],e.phoneCountryCode[e.item.tag]?e.phoneCountryCode[e.item.tag]:e.locationCountry))==null?void 0:a.number;console.log("formatted number:::",i);const o={locationId:e.locationId,phone:i,type:f.value?"survey":"form",mediumId:e.mediumId};$fetch(`${L.public.FORMS_SERVICE_URL}/forms/verify-phone`,{method:"POST",body:o}).then(m=>{U.value=m.token}).catch(m=>{console.error(m)})},Z=()=>{const i={locationId:e.locationId,phone:e.formFieldsValue[e.item.tag],type:f.value?"survey":"form",token:U.value,otp:k.value,mediumId:e.mediumId};$fetch(`${L.public.FORMS_SERVICE_URL}/forms/verify-phone`,{method:"POST",body:i}).then(o=>{o!=null&&o.ok&&(s(e.item.tag,null),p.value=null,I.value=!0,V.value=!1,b("verifyPhone","Yes"))}).catch(o=>{s(e.item.tag,"The security code is not correct or has been used. Try with a new code."),f.value&&(p.value="The security code is not correct or has been used. Try with a new code."),console.error(o)})},A=()=>{k.value="",V.value=!1,s(e.item.tag,null),p.value=null},s=(i,o)=>{b("addOrUpdateError",{tag:i,error:o})};ee(()=>e.phoneCountryDerived,(i,o)=>{o!==i&&w.value&&x()}),te(()=>{var i;(i=C.value)==null||i.destroy()});const S=v(()=>[q.ONE_COLUMN,q.TWO_COLUMN,q.SINGLE_LINE].includes(e.layoutType)?e.item.fieldWidthPercentage?e.item.fieldWidthPercentage<=50:!0:e.layoutType===!0&&e.checkFullWidthPosition);return j({validate:H,item:e.item}),(i,o)=>P((l(),d("div",null,[r("div",{class:c([{"d-none":t.item.hidden},"field-container"])},[r("div",{id:"form-"+t.item.tag,class:c(["form-builder--item",{"form-builder--item-input":t.kind=="survey"}])},[n(f)&&t.item.description!==void 0?(l(),d("label",{key:0,innerHTML:t.item.description,class:"item-description"},null,8,ke)):u("",!0),t.formLabelVisible?(l(),d("label",pe,[y(g(t.item.label||"Â ")+" ",1),t.item.required?(l(),d("span",Ve,"*")):u("",!0)])):u("",!0),t.item.tag=="phone"?(l(),d("div",Se,[P(r("div",{class:c(["phone-input",n(S)?"block":"flex"])},[t.item.tag=="phone"?(l(),d("input",{key:0,onInput:K,value:t.formattedPhone[t.item.tag],type:"tel",name:t.item.tag,placeholder:!t.formLabelVisible&&t.item.required?t.item.placeholder+"*":t.item.placeholder,autocomplete:"off",class:c(n(w)?"countryphone":"form-control"),ref:a=>O.value=a,id:t.item.tag,"data-q":t.item.hiddenFieldQueryKey,"data-required":t.item.required,onKeyup:o[0]||(o[0]=a=>T(t.item)),onKeydown:o[1]||(o[1]=M(F(a=>N({}),["prevent"]),["enter"]))},null,42,Pe)):u("",!0),n(Y)?(l(),d("button",{key:1,onClick:F(G,["prevent"]),class:c(["verify-phone-btn",n(S)?"mt-3":""]),style:ie({fontSize:`${t.fontSize}px`})}," Verify Phone ",14,Fe)):u("",!0)],2),[[oe,!n(V)&&!n(I)]]),n(I)?(l(),d("div",we,[r("img",{src:n(be),height:"18",width:"18",alt:"verified",class:"mr-3"},null,8,Ie),r("span",null,[y(" Your phone "),r("b",null,g(t.formFieldsValue[t.item.tag]),1),y(" has been successfully verified.")])])):u("",!0),n(V)?(l(),d("div",Te,[r("p",null,[y(" Your verification code has been sent to "),r("b",null,g(t.formFieldsValue[t.item.tag]),1),y(". "),qe,y("Kindly review your sms and insert the code below to complete the verification process. ")]),r("div",{class:c(["phone-input mt-3",n(S)||n($)()?"block":"flex"])},[P(r("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=a=>ne(k)?k.value=a:null),maxlength:"6",class:"otp",placeholder:"Enter OTP"},null,512),[[R,n(k)]]),r("div",{class:c(n(S)||n($)()?"mt-3 block":"flex")},[r("button",{onClick:F(Z,["prevent"]),class:c(["confirm-btn",n(S)?"mb-3":""])}," Confirm Code ",10,Le),r("button",{onClick:F(A,["prevent"]),class:"reset-btn"}," Edit Phone ",8,Oe)],2)],2)])):u("",!0)])):n(z)&&t.item.tag=="website"?P((l(),d("input",{key:3,"onUpdate:modelValue":o[3]||(o[3]=a=>t.formFieldsValue[t.item.tag]=a),placeholder:!t.formLabelVisible&&t.item.required?t.item.placeholder+"*":t.item.placeholder,name:t.item.tag,type:"text",class:"form-control",id:t.item.tag,"data-q":t.item.hiddenFieldQueryKey,"data-required":t.item.required},null,8,Ee)),[[R,t.formFieldsValue[t.item.tag]]]):P((l(),d("input",{key:4,"onUpdate:modelValue":o[4]||(o[4]=a=>t.formFieldsValue[t.item.tag]=a),type:t.item.type,placeholder:!t.formLabelVisible&&t.item.required?t.item.placeholder+"*":t.item.placeholder,name:t.item.tag,onKeydown:o[5]||(o[5]=M(F(a=>N({}),["prevent"]),["enter"])),class:"form-control",id:t.item.tag,"data-q":t.item.hiddenFieldQueryKey,"data-required":t.item.required},null,40,Ne)),[[ae,t.formFieldsValue[t.item.tag]]]),n(E)?(l(),d("div",xe,g(n(E)),1)):u("",!0),n(p)&&t.item.tag=="phone"?(l(),d("div",Ue,g(n(p)),1)):u("",!0),t.item.shortLabel?(l(),le(ge,{key:7},{default:re(()=>[y(g(t.item.shortLabel),1)]),_:1})):u("",!0)],10,Ce)],2)])),[[n(fe),W]])}});export{We as _};
