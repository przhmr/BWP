import{d as $,I as W,c as p,r as E,a as n,b as s,f as l,i as m,Q as f,t as v,e as a,n as y,w,R as I,a7 as K,z as S,m as j,S as Y,h as D,p as H,P as Q}from"./entry.819ce933.js";import{b as A,i as G,c as J}from"./HtmlInput.vue.5c04a560.js";import{C as X}from"./check-circle.5da2af7d.js";import{S as Z}from"./ShortLabel.239ac2f5.js";import{aq as O,as as M}from"./constants.8e39bf94.js";import"./index.f1fa0ff4.js";import"./HtmlPreview.vue.e838f505.js";import"./HLConst.18ce99b8.js";const _=["innerHTML"],ee={key:1},te={key:0},ie=["placeholder","name","data-q","data-required"],le=["onClick"],ae={key:1,class:"verified-text"},oe=["src"],ne={key:2,class:"verification-container"},re=a("br",null,null,-1),se=["onClick"],me=["onClick"],de={key:2,id:"error-container",class:"error"},ue={key:3,id:"error-container",class:"error"},Ee=$({__name:"EmailElement",props:{kind:{type:String},item:{type:Object},formLabelVisible:{type:Boolean},formFieldsValue:{type:Object},layoutType:{type:[Number,Boolean]},checkFullWidthPosition:{type:Boolean},fontSize:{type:[Number,String]},locationId:{type:String},errors:{type:Object,default:()=>({})}},emits:["addOrUpdateError","isSlideMovable","verifyEmail"],setup(t,{expose:N,emit:C}){const e=t,x=Q(),{t:F}=W(),u=p(()=>e.kind=="survey"),L=p(()=>e.errors[e.item.tag]),P=o=>{u.value&&C("isSlideMovable",o)},R=()=>{var i;if(u.value)return;const o=e.formFieldsValue[e.item.tag];if(e.item.required&&G(o))d(e.item.tag,F("email_error"));else{if(!J(o)){d(e.item.tag,F("guest_email_invalid_error"));return}if(e.item.enableValidateEmail&&!((i=e.item)!=null&&i.hidden)&&!V.value&&o){d(e.item.tag,"Email is not verified!");return}d(e.item.tag,null)}},b=E(""),c=E(null),T=E(null),h=E(!1),V=E(!1),q=p(()=>e.item.enableValidateEmail&&A(e.formFieldsValue[e.item.tag])),U=()=>{const o={locationId:e.locationId,email:e.formFieldsValue[e.item.tag],type:u.value?"survey":"form"};$fetch(`${x.public.FORMS_SERVICE_URL}/forms/verify-email`,{method:"POST",body:o}).then(i=>{T.value=i.token,d(e.item.tag,null),c.value=null,h.value=!0}).catch(i=>{var r,k;d(e.item.tag,(r=i.data)==null?void 0:r.message),u.value&&(c.value=(k=i.data)==null?void 0:k.message),console.error(i)})},B=()=>{const o={locationId:e.locationId,email:e.formFieldsValue[e.item.tag],type:u.value?"survey":"form",token:T.value,otp:b.value};$fetch(`${x.public.FORMS_SERVICE_URL}/forms/verify-email`,{method:"POST",body:o}).then(i=>{i!=null&&i.ok&&(d(e.item.tag,null),c.value=null,V.value=!0,h.value=!1,C("verifyEmail","Yes"))}).catch(i=>{var r,k;d(e.item.tag,(r=i.data)==null?void 0:r.message),u.value&&(c.value=(k=i.data)==null?void 0:k.message),console.error(i)})},z=()=>{e.formFieldsValue[e.item.tag]="",b.value="",h.value=!1,d(e.item.tag,null),c.value=null},d=(o,i)=>{C("addOrUpdateError",{tag:o,error:i})},g=p(()=>[O.ONE_COLUMN,O.TWO_COLUMN,O.SINGLE_LINE].includes(e.layoutType)?e.item.fieldWidthPercentage?e.item.fieldWidthPercentage<=50:!0:e.layoutType===!0&&e.checkFullWidthPosition);return N({validate:R,item:e.item}),(o,i)=>(n(),s("div",{class:y(["form-builder--item field-container",{"d-none":t.item.hidden,"form-builder--item-input":t.kind==="survey"}])},[l(u)&&t.item.description!==void 0?(n(),s("label",{key:0,innerHTML:t.item.description,class:"item-description",style:{display:"block"}},null,8,_)):m("",!0),t.formLabelVisible?(n(),s("label",ee,[f(v(t.item.label)+" ",1),t.item.required?(n(),s("span",te,"*")):m("",!0)])):m("",!0),a("div",null,[!l(h)&&!l(V)?(n(),s("div",{key:0,class:y(["email-input",l(g)?"block":"flex"])},[w(a("input",{"onUpdate:modelValue":i[0]||(i[0]=r=>t.formFieldsValue[t.item.tag]=r),placeholder:!t.formLabelVisible&&t.item.required?t.item.placeholder+"*":t.item.placeholder,name:t.item.tag,onKeydown:i[1]||(i[1]=K(S(r=>P({}),["prevent"]),["enter"])),type:"email",class:"form-control","data-q":t.item.hiddenFieldQueryKey,"data-required":t.item.required},null,40,ie),[[I,t.formFieldsValue[t.item.tag]]]),l(q)?(n(),s("button",{key:0,onClick:S(U,["prevent"]),class:y(["preview-common-btn",l(g)?"mt-3":""]),style:j({fontSize:`${t.fontSize}px`})}," Verify Email ",14,le)):m("",!0)],2)):m("",!0),l(V)?(n(),s("div",ae,[a("img",{src:l(X),height:"18",width:"18",alt:"verified",class:"mr-3"},null,8,oe),a("span",null,[f(" Your email "),a("b",null,v(t.formFieldsValue[t.item.tag]),1),f(" has been successfully verified.")])])):m("",!0),l(h)?(n(),s("div",ne,[a("p",null,[f(" Your verification code has been sent to "),a("b",null,v(t.formFieldsValue[t.item.tag]),1),f(". "),re,f("Kindly review your email inbox and insert the code below to complete the verification process. ")]),a("div",{class:y(["email-input mt-3",l(g)||l(M)()?"block":"flex"])},[w(a("input",{type:"text","onUpdate:modelValue":i[2]||(i[2]=r=>Y(b)?b.value=r:null),maxlength:"6",class:"otp",placeholder:"Enter OTP"},null,512),[[I,l(b)]]),a("div",{class:y(l(g)||l(M)()?"mt-3 block":"flex")},[a("button",{onClick:S(B,["prevent"]),class:y(["confirm-btn",l(g)?"mb-3":""])}," Confirm Code ",10,se),a("button",{onClick:S(z,["prevent"]),class:"reset-btn"}," Edit Email ",8,me)],2)],2)])):m("",!0)]),l(L)?(n(),s("div",de,v(l(L)),1)):m("",!0),l(c)?(n(),s("div",ue,v(l(c)),1)):m("",!0),t.item.shortLabel?(n(),D(Z,{key:4},{default:H(()=>[f(v(t.item.shortLabel),1)]),_:1})):m("",!0)],2))}});export{Ee as default};
